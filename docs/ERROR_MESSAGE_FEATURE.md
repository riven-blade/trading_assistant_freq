# ä¸‹å•å¤±è´¥åŸå› å±•ç¤ºåŠŸèƒ½

## âœ… åŠŸèƒ½è¯´æ˜

å½“ä»·æ ¼ç›‘æ§è§¦å‘ä¸‹å•å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šä¿å­˜å¤±è´¥åŸå› ï¼Œå¹¶åœ¨è®¢å•ç®¡ç†é¡µé¢å±•ç¤ºã€‚

## ğŸ“Š å®ç°ç»†èŠ‚

### 1. åç«¯æ•°æ®ç»“æ„

**æ¨¡å‹å­—æ®µ**ï¼š`models/coin.go`

```go
type PriceEstimate struct {
    ...
    Status       string  `json:"status"`        // çŠ¶æ€ï¼šlistening, triggered, failed
    ErrorMessage string  `json:"error_message"` // å¤±è´¥åŸå› ï¼ˆä»…åœ¨status=failedæ—¶æœ‰å€¼ï¼‰
    ...
}
```

### 2. å¤±è´¥åŸå› ä¿å­˜

**ä½ç½®**ï¼š`core/monitor_core.go`

#### åœºæ™¯1ï¼šè®¢å•æ‰§è¡Œå¤±è´¥

```go
func (pm *PriceMonitor) triggerEstimate(estimate *models.PriceEstimate, currentPrice float64) {
    err := pm.orderExecutor.ExecuteOrder(estimate, currentPrice)
    if err != nil {
        estimate.Status = models.EstimateStatusFailed
        estimate.ErrorMessage = err.Error() // ä¿å­˜å¤±è´¥åŸå› 
    }
}
```

**å¤±è´¥åŸå› ç¤ºä¾‹**ï¼š
- "freqtrade APIé”™è¯¯: connection refused"
- "ä¸‹å•å‚æ•°é”™è¯¯: æ•°é‡ä¸è¶³æœ€å°é™åˆ¶"
- "ä½™é¢ä¸è¶³"

#### åœºæ™¯2ï¼šèµ„é‡‘è´¹ç‡æ£€æŸ¥å¤±è´¥ï¼ˆåšç©ºç‰¹æœ‰ï¼‰

```go
func (pm *PriceMonitor) checkFundingRateForShort(estimate *models.PriceEstimate, markPriceData *types.WatchMarkPrice) bool {
    if currentFundingRate < threshold {
        errorMsg := fmt.Sprintf("èµ„é‡‘è´¹ç‡è¿‡ä½: å½“å‰%.4f%% < é˜ˆå€¼%.4f%%ï¼Œä¸å…è®¸å¼€ç©ºä»“",
            currentFundingRate*100, threshold*100)
        
        estimate.Status = models.EstimateStatusFailed
        estimate.ErrorMessage = errorMsg
    }
}
```

**å¤±è´¥åŸå› ç¤ºä¾‹**ï¼š
- "èµ„é‡‘è´¹ç‡è¿‡ä½: å½“å‰0.0050% < é˜ˆå€¼0.0100%ï¼Œä¸å…è®¸å¼€ç©ºä»“"

### 3. å‰ç«¯UIå±•ç¤º

**ä½ç½®**ï¼š`web/src/pages/Orders.js`

#### UIè®¾è®¡

```javascript
{
  title: 'çŠ¶æ€',
  render: (status, record) => {
    const tag = <Tag color={colorMap[status]}>{statusMap[status]}</Tag>;
    
    // å¤±è´¥çŠ¶æ€ï¼šé¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºåŸå› 
    if (status === 'failed' && record.error_message) {
      return (
        <Tooltip 
          title={
            <div>
              <div style={{ fontWeight: 'bold' }}>å¤±è´¥åŸå› ï¼š</div>
              <div>{record.error_message}</div>
            </div>
          }
          color="red"
          placement="topLeft"
        >
          <span style={{ cursor: 'help' }}>
            {tag}
          </span>
        </Tooltip>
      );
    }
    
    return tag;
  }
}
```

#### ç”¨æˆ·ä½“éªŒ

| çŠ¶æ€ | æ˜¾ç¤ºæ•ˆæœ | äº¤äº’æ–¹å¼ |
|------|---------|---------|
| **ç›‘å¬ä¸­** | è“è‰²æ ‡ç­¾"ç›‘å¬ä¸­" | æ—  |
| **å·²è§¦å‘** | ç»¿è‰²æ ‡ç­¾"å·²è§¦å‘" | æ—  |
| **å¤±è´¥** | çº¢è‰²æ ‡ç­¾"å¤±è´¥" | é¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºåŸå›  âš ï¸ |

#### è§†è§‰æ•ˆæœ

```
æ™®é€šçŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ å·²è§¦å‘  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¤±è´¥çŠ¶æ€ï¼ˆé¼ æ ‡æ‚¬æµ®å‰ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ— å¤±è´¥    â”‚  â† cursor: help
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¤±è´¥çŠ¶æ€ï¼ˆé¼ æ ‡æ‚¬æµ®åï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤±è´¥åŸå› ï¼š                      â”‚
â”‚ èµ„é‡‘è´¹ç‡è¿‡ä½: å½“å‰0.0050% <     â”‚
â”‚ é˜ˆå€¼0.0100%ï¼Œä¸å…è®¸å¼€ç©ºä»“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ— å¤±è´¥    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å¸¸è§å¤±è´¥åŸå› 

### 1. èµ„é‡‘è´¹ç‡æ£€æŸ¥å¤±è´¥
```
èµ„é‡‘è´¹ç‡è¿‡ä½: å½“å‰0.0050% < é˜ˆå€¼0.0100%ï¼Œä¸å…è®¸å¼€ç©ºä»“
```

### 2. APIè¿æ¥é”™è¯¯
```
freqtrade APIé”™è¯¯: connection refused
```

### 3. å‚æ•°é”™è¯¯
```
ä¸‹å•å‚æ•°é”™è¯¯: æ•°é‡ä¸è¶³æœ€å°é™åˆ¶ 0.001 BTC
```

### 4. ä½™é¢ä¸è¶³
```
ä½™é¢ä¸è¶³: éœ€è¦ 100 USDTï¼Œå½“å‰ä½™é¢ 50 USDT
```

### 5. å¸‚åœºé™åˆ¶
```
å¸‚åœºé™åˆ¶: BTCUSDT å½“å‰ä¸å…è®¸äº¤æ˜“
```

## ğŸ“ˆ æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä»·æ ¼è§¦å‘                              â”‚
â”‚    PriceMonitor.checkSingleEstimate()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ‰§è¡Œæ£€æŸ¥                              â”‚
â”‚    - èµ„é‡‘è´¹ç‡æ£€æŸ¥ (åšç©º)                  â”‚
â”‚    - è®¢å•æ‰§è¡Œ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ (å¤±è´¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¿å­˜å¤±è´¥åŸå›                           â”‚
â”‚    estimate.ErrorMessage = err.Error()  â”‚
â”‚    estimate.Status = "failed"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å­˜å‚¨åˆ°Redis                           â”‚
â”‚    redis.SetPriceEstimate(estimate)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. WebSocketå¹¿æ’­æ›´æ–°                     â”‚
â”‚    BroadcastSymbolEstimatesUpdate()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å‰ç«¯æ¥æ”¶å¹¶å±•ç¤º                         â”‚
â”‚    - çº¢è‰²"å¤±è´¥"æ ‡ç­¾                       â”‚
â”‚    - Tooltipæ‚¬æµ®æ˜¾ç¤ºåŸå›                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æµ‹è¯•åœºæ™¯

### æµ‹è¯•1ï¼šèµ„é‡‘è´¹ç‡å¤±è´¥
1. è®¾ç½®èµ„é‡‘è´¹ç‡é˜ˆå€¼ä¸º 0.01%
2. ç­‰å¾…èµ„é‡‘è´¹ç‡ä½äºé˜ˆå€¼æ—¶è§¦å‘åšç©º
3. æŸ¥çœ‹è®¢å•é¡µé¢ï¼Œå¤±è´¥çŠ¶æ€æ‚¬æµ®æ˜¾ç¤ºåŸå› 

### æµ‹è¯•2ï¼šAPIé”™è¯¯
1. åœæ­¢ freqtrade æœåŠ¡
2. è§¦å‘ä»·æ ¼ç›‘æ§ä¸‹å•
3. æŸ¥çœ‹å¤±è´¥åŸå› ï¼š"freqtrade APIé”™è¯¯: connection refused"

### æµ‹è¯•3ï¼šå‚æ•°é”™è¯¯
1. è®¾ç½®ä¸åˆç†çš„ä¸‹å•æ•°é‡
2. è§¦å‘ä¸‹å•
3. æŸ¥çœ‹å¤±è´¥åŸå› ï¼šå‚æ•°éªŒè¯é”™è¯¯ä¿¡æ¯

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é”™è¯¯ä¿¡æ¯æ¸…ç†**
   - æˆåŠŸè§¦å‘åï¼Œ`ErrorMessage` ä¼šè¢«æ¸…ç©º
   - é¿å…æ˜¾ç¤ºæ—§çš„é”™è¯¯ä¿¡æ¯

2. **é”™è¯¯ä¿¡æ¯é•¿åº¦**
   - Tooltip æœ€å¤§å®½åº¦ 300px
   - è‡ªåŠ¨æ¢è¡Œæ˜¾ç¤ºé•¿æ–‡æœ¬

3. **å…¼å®¹æ€§**
   - æ—§æ•°æ®æ²¡æœ‰ `error_message` å­—æ®µ
   - å‰ç«¯åšäº†ç©ºå€¼åˆ¤æ–­ï¼Œä¸ä¼šæŠ¥é”™

4. **å®æ—¶æ›´æ–°**
   - é€šè¿‡ WebSocket å®æ—¶æ¨é€
   - ç”¨æˆ·æ— éœ€åˆ·æ–°å³å¯çœ‹åˆ°æœ€æ–°çŠ¶æ€

## ğŸš€ ä¼˜åŒ–å»ºè®®

### æœªæ¥å¯èƒ½çš„æ”¹è¿›

1. **é”™è¯¯åˆ†ç±»**
   ```go
   ErrorType    string // "api_error", "param_error", "funding_rate", etc.
   ErrorCode    int    // é”™è¯¯ç 
   ErrorMessage string // é”™è¯¯è¯¦æƒ…
   ```

2. **å¤šè¯­è¨€æ”¯æŒ**
   - å‰ç«¯æ ¹æ®è¯­è¨€è®¾ç½®æ˜¾ç¤ºä¸åŒæ–‡æ¡ˆ

3. **é”™è¯¯ç»Ÿè®¡**
   - ç»Ÿè®¡å„ç±»é”™è¯¯çš„å‘ç”Ÿé¢‘ç‡
   - ç”Ÿæˆé”™è¯¯æŠ¥è¡¨

4. **é‡è¯•æœºåˆ¶**
   - æŸäº›å¤±è´¥å¯ä»¥è‡ªåŠ¨é‡è¯•
   - è®°å½•é‡è¯•æ¬¡æ•°å’Œç»“æœ

---

**åŠŸèƒ½å®Œæˆæ—¶é—´**: 2025-01-16  
**çŠ¶æ€**: âœ… å·²å®ç°å¹¶æµ‹è¯•  
**ç›¸å…³æ–‡ä»¶**:
- `models/coin.go` - æ•°æ®æ¨¡å‹
- `core/monitor_core.go` - åç«¯é€»è¾‘
- `web/src/pages/Orders.js` - å‰ç«¯å±•ç¤º

